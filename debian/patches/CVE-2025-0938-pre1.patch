From 3bb28d4743e42ae90522d32642dccb5dc969408f Mon Sep 17 00:00:00 2001
From: Tim Graham <timograham@gmail.com>
Date: Tue, 14 Mar 2017 09:27:31 -0400
Subject: [PATCH] bpo-22891: Remove urlsplit() optimization for 'http' prefixed
 inputs.

---
 Lib/urllib/parse.py | 15 ---------------
 1 file changed, 15 deletions(-)

--- python3.8-3.8.10.orig/Lib/urllib/parse.py
+++ python3.8-3.8.10/Lib/urllib/parse.py
@@ -462,22 +462,7 @@ def urlsplit(url, scheme='', allow_fragm
         clear_cache()
     netloc = query = fragment = ''
     i = url.find(':')
-    if i > 0 and url[0].isascii() and url[0].isalpha():
-        if url[:i] == 'http': # optimize the common case
-            url = url[i+1:]
-            if url[:2] == '//':
-                netloc, url = _splitnetloc(url, 2)
-                if (('[' in netloc and ']' not in netloc) or
-                        (']' in netloc and '[' not in netloc)):
-                    raise ValueError("Invalid IPv6 URL")
-            if allow_fragments and '#' in url:
-                url, fragment = url.split('#', 1)
-            if '?' in url:
-                url, query = url.split('?', 1)
-            _checknetloc(netloc)
-            v = SplitResult('http', netloc, url, query, fragment)
-            _parse_cache[key] = v
-            return _coerce_result(v)
+    if i > 0:
         for c in url[:i]:
             if c not in scheme_chars:
                 break

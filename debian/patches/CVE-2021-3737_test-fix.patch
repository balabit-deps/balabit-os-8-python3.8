From 0389426fa4af4dfc8b1d7f3f291932d928392d8b Mon Sep 17 00:00:00 2001
From: "Miss Islington (bot)"
 <31488909+miss-islington@users.noreply.github.com>
Date: Mon, 12 Jul 2021 08:09:01 -0700
Subject: [PATCH] bpo-44022: Improve the regression test. (GH-26503) (#26506)

It wasn't actually detecting the regression due to the assertion being too lenient.
(cherry picked from commit e60ab843cbb016fb6ff8b4f418641ac05a9b2fcc)

Co-authored-by: Gregory P. Smith <greg@krypto.org>
---
 Lib/test/test_httplib.py | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

Index: python3.8-3.8.10/Lib/test/test_httplib.py
===================================================================
--- python3.8-3.8.10.orig/Lib/test/test_httplib.py
+++ python3.8-3.8.10/Lib/test/test_httplib.py
@@ -1009,7 +1009,12 @@ class BasicTest(TestCase):
             'r\n' * 32768
         )
         resp = client.HTTPResponse(FakeSocket(body))
-        self.assertRaises(client.HTTPException, resp.begin)
+        with self.assertRaises(client.HTTPException) as cm:
+            resp.begin()
+        # We must assert more because other reasonable errors that we
+        # do not want can also be HTTPException derived.
+        self.assertIn('got more than ', str(cm.exception))
+        self.assertIn('headers', str(cm.exception))
 
     def test_overflowing_chunked_line(self):
         body = (
